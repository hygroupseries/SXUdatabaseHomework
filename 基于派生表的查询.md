## 基于派生表的查询

查询平均成绩大于90分的学生的学号与姓名

```
SELECT s.sno, s.sname
FROM student s
JOIN (SELECT sno FROM sc
GROUP BY sno
HAVING AVG(grade) > 90) as avg_grade ON s.sno = avg_grade.sno;
```

查询每个学生超过其平均成绩的课程号及成绩

```
SELECT sno, cno, grade
FROM sc s1
WHERE grade > (
    SELECT AVG(grade)
    FROM sc s2
    WHERE s2.sno = s1.sno
);

```

只有所选课程成绩全部大于70分的学生才有资格评奖学金，请将这些学生按照平均分进行排名，并输出前5名同学的学号以及平均成绩。

```
except
select * from sc where grade < 70;
```

```
SELECT s1.sno, AVG(s1.grade) as avg_grade
FROM sc s1
where s1.sno not in
(select DISTINCT sno 
FROM sc where grade < 70)
GROUP by s1.sno 
ORDER BY  AVG(s1.grade) DESC
LIMIT 5 ;

SELECT s1.sno, AVG(s1.grade) as avg_grade
FROM sc s1
WHERE s1.sno NOT IN (
    SELECT DISTINCT sno 
    FROM sc 
    WHERE grade < 70
)
GROUP BY s1.sno
ORDER BY avg_grade DESC
LIMIT 5;
```

